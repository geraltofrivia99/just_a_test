import React, { Component } from 'react'
import Waypoint from 'react-waypoint';

var currentIndex = 0;
var generateItem = function() {
  var chooseCat = Math.floor(Math.random() * 2);
  var ind = (currentIndex % 10) + 1;
  var newImage = (chooseCat) ?
    'http://lorempixel.com/output/cats-q-c-640-480-' + ind + '.jpg':
    'http://lorempixel.com/output/technics-q-c-640-480-' + ind + '.jpg';
  currentIndex++;
  return newImage;
}

export default class wayp extends Component {
    constructor(props){
        super(props)
        this.state = {
            items:[
                'http://lorempixel.com/output/cats-q-c-640-480-9.jpg',
                'http://lorempixel.com/output/cats-q-c-640-480-10.jpg',
                'http://lorempixel.com/output/technics-q-c-640-480-10.jpg'
            ],
            isLoading: false
        }
    }
    _loadMoreItems = () => {
        let itemsToAdd = 3
        let secondsToWait = 2
        this.setState({
            isLoading: true
        })
        setTimeout(()=>{
            let currentItems = this.state.items
            for (let i = 0; i < itemsToAdd; i++){
                currentItems.push(generateItem())
            }
            this.setState({
                items: currentItems,
                isLoading: false
            })
        }, secondsToWait * 1000)
    }
   
    _renderItems =()=> {
        return this.state.items.map((imageUrl,index)=>{
            return (
                <img 
                src={imageUrl} 
                alt="Cats AND ROBOTS..."
                style={{height: 480}}
                key={index}
                className='infinite-scroll-example__list-item'
                />
            )
        })
    }

_renderWaypoint = () => {
    if (!this.state.isLoading) {
        return (
            <Waypoint
                onEnter={this._loadMoreItems}
            />
        )
    }
}

  render() {
    return (
        <div className="infinite-scroll-example">
        <p className="infinite-scroll-example__count">
          Items Loaded: {this.state.items.length}
        </p>
        <div className="infinite-scroll-example__scrollable-parent">
          {this._renderItems()}
          <div className="infinite-scroll-example__waypoint">
            {this._renderWaypoint()}
            Loading more itemsâ€¦
          </div>
        </div>
        <p className="infinite-scroll-example__arrow" />
      </div>
    )
  }
}
